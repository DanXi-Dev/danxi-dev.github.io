import{D,b0 as re,af as ae,S as z,p as ie,a6 as le,b1 as w,a4 as ue,a5 as se,q as _,a7 as te,P as Y,h as ce}from"./framework.Bf-WjO2H.js";function ne(e){return ue()?(se(e),!0):!1}function R(){const e=new Set,n=t=>{e.delete(t)};return{on:t=>{e.add(t);const o=()=>n(t);return ne(o),{off:o}},off:n,trigger:(...t)=>Promise.all(Array.from(e).map(o=>o(...t))),clear:()=>{e.clear()}}}const oe=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const K=()=>{};function V(...e){if(e.length!==1)return ae(...e);const n=e[0];return typeof n=="function"?z(le(()=>({get:n,set:K}))):ie(n)}function fe(e,n){function a(...i){return new Promise((l,t)=>{Promise.resolve(e(()=>n.apply(this,i),{fn:n,thisArg:this,args:i})).then(l).catch(t)})}return a}function de(e,n={}){let a,i,l=K;const t=f=>{clearTimeout(f),l(),l=K};let o;return f=>{const v=w(e),d=w(n.maxWait);return a&&t(a),v<=0||d!==void 0&&d<=0?(i&&(t(i),i=null),Promise.resolve(f())):new Promise((r,u)=>{l=n.rejectOnCancel?u:r,o=f,d&&!i&&(i=setTimeout(()=>{a&&t(a),i=null,r(o())},d)),a=setTimeout(()=>{i&&t(i),i=null,r(f())},v)})}}function Z(e,n=!1,a="Timeout"){return new Promise((i,l)=>{setTimeout(n?()=>l(a):i,e)})}function pe(e,...n){return n.some(a=>a in e)}function we(e,n=200,a={}){return fe(de(n,a),e)}function L(e,n=!1){function a(r,{flush:u="sync",deep:h=!1,timeout:p,throwOnTimeout:g}={}){let m=null;const E=[new Promise(b=>{m=_(e,P=>{r(P)!==n&&(m?m():Y(()=>m==null?void 0:m()),b(P))},{flush:u,deep:h,immediate:!0})})];return p!=null&&E.push(Z(p,g).then(()=>w(e)).finally(()=>m==null?void 0:m())),Promise.race(E)}function i(r,u){if(!te(r))return a(P=>P===r,u);const{flush:h="sync",deep:p=!1,timeout:g,throwOnTimeout:m}=u??{};let y=null;const b=[new Promise(P=>{y=_([e,r],([O,x])=>{n!==(O===x)&&(y?y():Y(()=>y==null?void 0:y()),P(O))},{flush:h,deep:p,immediate:!0})})];return g!=null&&b.push(Z(g,m).then(()=>w(e)).finally(()=>(y==null||y(),w(e)))),Promise.race(b)}function l(r){return a(u=>!!u,r)}function t(r){return i(null,r)}function o(r){return i(void 0,r)}function F(r){return a(Number.isNaN,r)}function f(r,u){return a(h=>{const p=Array.from(h);return p.includes(r)||p.includes(w(r))},u)}function v(r){return d(1,r)}function d(r=1,u){let h=-1;return a(()=>(h+=1,h>=r),u)}return Array.isArray(w(e))?{toMatch:a,toContains:f,changed:v,changedTimes:d,get not(){return L(e,!n)}}:{toMatch:a,toBe:i,toBeTruthy:l,toBeNull:t,toBeNaN:F,toBeUndefined:o,changed:v,changedTimes:d,get not(){return L(e,!n)}}}function me(e){return L(e)}function he(e,n,a={}){const{immediate:i=!0,immediateCallback:l=!1}=a,t=D(!1);let o=null;function F(){o&&(clearTimeout(o),o=null)}function f(){t.value=!1,F()}function v(...d){l&&e(),F(),t.value=!0,o=setTimeout(()=>{t.value=!1,o=null,e(...d)},w(n))}return i&&(t.value=!0,oe&&v()),ne(f),{isPending:re(t),start:v,stop:f}}const ye=oe?window:void 0,ve={json:"application/json",text:"text/plain"};function ee(e){return e&&pe(e,"immediate","refetch","initialData","timeout","beforeFetch","afterFetch","onFetchError","fetch","updateDataOnError")}function $(e){return typeof Headers<"u"&&e instanceof Headers?Object.fromEntries(e.entries()):e}function be(e,...n){var a;const i=typeof AbortController=="function";let l={},t={immediate:!0,refetch:!1,timeout:0,updateDataOnError:!1};const o={method:"GET",type:"text",payload:void 0};n.length>0&&(ee(n[0])?t={...t,...n[0]}:l=n[0]),n.length>1&&ee(n[1])&&(t={...t,...n[1]});const{fetch:F=(a=ye)==null?void 0:a.fetch,initialData:f,timeout:v}=t,d=R(),r=R(),u=R(),h=D(!1),p=D(!1),g=D(!1),m=D(null),y=D(null),E=D(null),b=D(f||null),P=ce(()=>i&&p.value);let O,x;const M=()=>{i&&(O==null||O.abort(),O=new AbortController,O.signal.onabort=()=>g.value=!0,l={...l,signal:O.signal})},I=c=>{p.value=c,h.value=!c};v&&(x=he(M,v,{immediate:!1}));let q=0;const B=async(c=!1)=>{var T,k;M(),I(!0),E.value=null,m.value=null,g.value=!1,q+=1;const W=q,C={method:o.method,headers:{}},H=w(o.payload);if(H){const s=$(C.headers),G=Object.getPrototypeOf(H);!o.payloadType&&H&&(G===Object.prototype||Array.isArray(G))&&!(H instanceof FormData)&&(o.payloadType="json"),o.payloadType&&(s["Content-Type"]=(T=ve[o.payloadType])!=null?T:o.payloadType),C.body=o.payloadType==="json"?JSON.stringify(H):H}let X=!1;const j={url:w(e),options:{...C,...l},cancel:()=>{X=!0}};if(t.beforeFetch&&Object.assign(j,await t.beforeFetch(j)),X||!F)return I(!1),Promise.resolve(null);let S=null;return x&&x.start(),F(j.url,{...C,...j.options,headers:{...$(C.headers),...$((k=j.options)==null?void 0:k.headers)}}).then(async s=>{if(y.value=s,m.value=s.status,S=await s.clone()[o.type](),!s.ok)throw b.value=f||null,new Error(s.statusText);return t.afterFetch&&({data:S}=await t.afterFetch({data:S,response:s,context:j,execute:B})),b.value=S,d.trigger(s),s}).catch(async s=>{let G=s.message||s.name;if(t.onFetchError&&({error:G,data:S}=await t.onFetchError({data:S,error:s,response:y.value,context:j,execute:B})),E.value=G,t.updateDataOnError&&(b.value=S),r.trigger(s),c)throw s;return null}).finally(()=>{W===q&&I(!1),x&&x.stop(),u.trigger(null)})},Q=V(t.refetch);_([Q,V(e)],([c])=>c&&B(),{deep:!0});const U={isFinished:z(h),isFetching:z(p),statusCode:m,response:y,error:E,data:b,canAbort:P,aborted:g,abort:M,execute:B,onFetchResponse:d.on,onFetchError:r.on,onFetchFinally:u.on,get:A("GET"),put:A("PUT"),post:A("POST"),delete:A("DELETE"),patch:A("PATCH"),head:A("HEAD"),options:A("OPTIONS"),json:N("json"),text:N("text"),blob:N("blob"),arrayBuffer:N("arrayBuffer"),formData:N("formData")};function A(c){return(T,k)=>{if(!p.value)return o.method=c,o.payload=T,o.payloadType=k,te(o.payload)&&_([Q,V(o.payload)],([W])=>W&&B(),{deep:!0}),{...U,then(W,C){return J().then(W,C)}}}}function J(){return new Promise((c,T)=>{me(h).toBe(!0).then(()=>c(U)).catch(T)})}function N(c){return()=>{if(!p.value)return o.type=c,{...U,then(T,k){return J().then(T,k)}}}}return t.immediate&&Promise.resolve().then(()=>B()),{...U,then(c,T){return J().then(c,T)}}}export{we as a,be as u};
